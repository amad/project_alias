<!DOCTYPE HTML>
<html>
<head>
    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.slim.js"></script>

</head>
<body>
  <button class="toggle" id="class0">add class 0</button>
  <br>
  <button class="toggle" id="class1">add class 1</button>
  <br>
  <button id="train">train</button>
  <br>
  <span>Prediction: </span><span id="result"></span>
  <br>
  <span>Examples: </span><span id="examples"></span>
  <br>
  <canvas id="canvas" width="256" height="256"> spectogram </canvas>

  <!-- Javascript -->
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
      var socket = io.connect('http://' + document.domain + ':' + location.port + '/socket');

      // Get data from python
      socket.on('response', function(msg) {
        //console.log(msg)
        var spectogram = $.parseJSON(msg.spectogram);
        drawSpectogram(spectogram);
        $('#result').text(msg.result);
        $('#examples').text(msg.examples);
      });

      var timeOut; 
      // Toggle mechanic
      $(".toggle").mousedown(function(){
        var msg = $(this).attr('id');
        timeOut=setInterval(function() {
           socket.emit('msgEvent', {data: msg});
        }, 100);
      })

      $(".toggle").mouseup(function(){
        clearInterval(timeOut)
      })

      //train btn
      $("#train").mousedown(function(){
        socket.emit('msgEvent',{data:"train"});
      })
 
    });

    /////////////////////////////////////////////////////
    // SPECTOGRAM
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext("2d");

    var resolution = 32;
    var xRes = canvas.width / resolution;
    var yRes = canvas.height / resolution;

    function drawSpectogram(data){
      //console.log("data: " + data)
      //Draw the spectrogram
      for (var x = 0; x < data.length-1; x++) {
        for (var y = data[0].length-1; y > 0; y--) {

          var value = Math.floor(data[x][y]);
          var hue = 140 //+(Math.abs(value)/6);
          var bri = mapRange(value,-80,0,0,100)

           if(value>80){
              ctx.fillStyle = 'hsl(0,100%,100%)';
          }else{
              ctx.fillStyle = 'hsl('+ hue +',100%,'+bri+'%)';
          }
          ctx.fillStyle = 'hsl('+ hue +',100%,'+bri+'%)';
          ctx.fillRect(xRes * x, yRes * y, xRes, yRes);
        }
      }
    }

    function mapRange (value, a, b, c, d) {
      value = (value - a) / (b - a);
      return c + value * (d - c);
    }

  </script>
</body>
</html>
